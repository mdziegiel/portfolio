<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UniFi VLAN Segmentation & Firewalls — MRDTech</title>
  <link rel="icon" href="../favicon.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { scroll-behavior: smooth; }
    .codebox {
      white-space: pre-wrap;
      word-break: break-word;
      background-color: #020617; /* slate-950-ish */
      border-radius: 0.75rem;
      padding: 1rem;
      overflow-x: auto;
      font-size: 0.875rem;
      border: 1px solid rgba(148, 163, 184, 0.6); /* slate-400 */
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.875rem;
    }
    th, td {
      border: 1px solid rgba(51, 65, 85, 0.9); /* slate-700 */
      padding: 0.5rem 0.75rem;
    }
    th {
      background-color: rgba(15, 23, 42, 0.9); /* slate-900 */
      text-align: left;
    }
    tr:nth-child(even) td {
      background-color: rgba(15, 23, 42, 0.6);
    }
  </style>
</head>

<body class="bg-[#0b0c0e] text-slate-200">
  <!-- Header -->
  <header class="sticky top-0 z-40 backdrop-blur bg-black/40 border-b border-slate-800">
    <div class="max-w-6xl mx-auto px-5 py-4 flex items-center justify-between">
      <a href="/" class="text-slate-100 font-semibold tracking-tight text-lg">mrdtech</a>
      <nav class="hidden sm:flex gap-6 text-sm text-slate-300">
        <a href="/#projects" class="hover:text-emerald-400">Projects</a>
        <a href="/#experience" class="hover:text-emerald-400">Experience</a>
        <a href="/#skills" class="hover:text-emerald-400">Skills</a>
        <a href="/#contact" class="hover:text-emerald-400">Contact</a>
      </nav>
    </div>
  </header>

  <!-- Main -->
  <main class="max-w-5xl mx-auto px-5 py-14">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-slate-100">
      UniFi VLAN Segmentation & Firewalls
    </h1>

    <p class="mt-4 text-slate-400 leading-relaxed">
      Opinionated UniFi design for isolating Home, Guest, IoT, and VPN/VLANs with
      sane north–south exposure (Plex, WireGuard, reverse proxy) and controlled
      east–west traffic. This mirrors my homelab layout and is easy to adapt
      for enterprise or SMB networks.
    </p>

    <!-- Design goals -->
    <section class="mt-10">
      <h2 class="text-2xl font-bold text-slate-100">1. Design Goals</h2>

      <ul class="mt-4 list-disc list-inside space-y-2 text-slate-300">
        <li>Keep <strong>home PCs and servers</strong> separate from IoT and Guest devices.</li>
        <li>Allow limited, intentional access (e.g., Plex from IoT TV, cameras to NVR).</li>
        <li>Force all clients to use internal DNS (AdGuard/Unbound) and block direct 53/853 to the internet.</li>
        <li>Expose only required services to WAN (WireGuard, reverse proxy) with tight rules.</li>
        <li>Make troubleshooting sane: simple, repeatable rules per VLAN.</li>
      </ul>
    </section>

    <!-- VLAN layout -->
    <section class="mt-10">
      <h2 class="text-2xl font-bold text-slate-100">2. VLAN & Subnet Layout</h2>

      <p class="mt-3 text-slate-300">
        Example layout similar to my homelab. Adjust VLAN IDs, names, and subnets
        for your environment.
      </p>

      <div class="mt-4 rounded-xl border border-slate-800 bg-slate-900/60 p-4">
        <h3 class="font-semibold text-slate-100 mb-3">VLANs</h3>
        <div class="overflow-x-auto">
          <table>
            <thead>
              <tr>
                <th>VLAN</th>
                <th>Name</th>
                <th>Subnet</th>
                <th>Use case</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>1</td>
                <td>Home</td>
                <td>10.10.10.0/24</td>
                <td>PCs, servers, lab gear, admin devices</td>
              </tr>
              <tr>
                <td>2</td>
                <td>Guest</td>
                <td>192.168.20.0/24</td>
                <td>Guest Wi-Fi, internet-only access</td>
              </tr>
              <tr>
                <td>3</td>
                <td>PrivateInternetAccess (VPN)</td>
                <td>192.168.30.0/24</td>
                <td>Devices forced out via PIA/other egress</td>
              </tr>
              <tr>
                <td>4</td>
                <td>IoT</td>
                <td>192.168.40.0/24</td>
                <td>TVs, cameras, smart plugs, random cloud things</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- UniFi networks -->
    <section class="mt-10">
      <h2 class="text-2xl font-bold text-slate-100">3. Create Networks in UniFi</h2>

      <ol class="mt-4 list-decimal list-inside space-y-2 text-slate-300">
        <li>Open the UniFi Network application.</li>
        <li>Go to <strong>Settings → Networks → Create new network</strong>.</li>
        <li>For each VLAN:
          <ul class="mt-2 list-disc list-inside ml-5 space-y-1">
            <li><strong>Name</strong>: e.g., <code>Home</code></li>
            <li><strong>Purpose</strong>: Corporate</li>
            <li><strong>VLAN ID</strong>: as per table above</li>
            <li><strong>Gateway/Subnet</strong>: e.g., <code>10.10.10.1/24</code></li>
            <li>DHCP: enabled for client segments (disable on infra-only nets if desired).</li>
          </ul>
        </li>
      </ol>

      <p class="mt-4 text-slate-400">
        At this point, UniFi knows about the VLANs, but everything can still talk to everything.
        The next step is firewall policy.
      </p>
    </section>

    <!-- Port profiles & SSIDs -->
    <section class="mt-10">
      <h2 class="text-2xl font-bold text-slate-100">4. Assign VLANs to Ports & Wi-Fi</h2>

      <h3 class="mt-4 font-semibold text-slate-100">Switch ports</h3>
      <ul class="mt-2 list-disc list-inside space-y-2 text-slate-300">
        <li>Create <strong>Port Profiles</strong> for each VLAN (Access ports): Home, Guest, IoT, VPN.</li>
        <li>For trunk uplinks, allow all required VLANs (e.g., between core switch and APs).</li>
        <li>Assign IoT devices (cameras, TVs, etc.) to the <strong>IoT</strong> profile, servers/PCs to <strong>Home</strong>.</li>
      </ul>

      <h3 class="mt-6 font-semibold text-slate-100">Wi-Fi SSIDs</h3>
      <ul class="mt-2 list-disc list-inside space-y-2 text-slate-300">
        <li>Create SSID <strong>Home</strong> → map to <strong>Home</strong> VLAN.</li>
        <li>Create SSID <strong>Guest</strong> → map to <strong>Guest</strong> VLAN (enable guest policies if desired).</li>
        <li>Create SSID <strong>IoT</strong> → map to <strong>IoT</strong> VLAN (WPA2-only if some devices are old).</li>
      </ul>
    </section>

    <!-- Firewall strategy -->
    <section class="mt-10">
      <h2 class="text-2xl font-bold text-slate-100">5. Firewall Strategy</h2>

      <p class="mt-3 text-slate-300">
        UniFi evaluates rules top-down. I keep rules organized by zone:
      </p>

      <ul class="mt-3 list-disc list-inside space-y-2 text-slate-300">
        <li><strong>LAN IN</strong> — controls traffic entering a VLAN from other internal networks.</li>
        <li><strong>LAN LOCAL</strong> — controls access to the gateway/router itself.</li>
        <li><strong>WAN IN</strong> — inbound from internet (usually very small set of allow rules).</li>
        <li><strong>WAN OUT</strong> — egress control (DNS, NTP, etc.).</li>
      </ul>

      <p class="mt-4 text-slate-400">
        The general pattern:
      </p>

      <ol class="mt-2 list-decimal list-inside space-y-1 text-slate-300">
        <li><strong>Block</strong> inter-VLAN by default.</li>
        <li><strong>Allow</strong> specific flows back in (e.g., Home → IoT cameras, IoT → NTP/DNS).</li>
        <li><strong>Allow</strong> trusted management devices to reach UniFi/routers.</li>
      </ol>
    </section>

    <!-- Example rules -->
    <section class="mt-10">
      <h2 class="text-2xl font-bold text-slate-100">6. Example Rules</h2>

      <p class="mt-3 text-slate-300">
        Below are example rule “shapes”. Names and exact ports can be tweaked.
      </p>

      <div class="mt-4 rounded-xl border border-slate-800 bg-slate-900/60 p-4 space-y-4">
        <h3 class="font-semibold text-slate-100">LAN IN — Deny East/West by Default</h3>
        <div class="codebox">
Rule Name: Block IoT → Home
Direction: LAN IN
Interface: IoT
Action: Drop
Source: IoT net (192.168.40.0/24)
Destination: Home net (10.10.10.0/24)
Comment: Prevent IoT from talking to Home devices
        </div>

        <div class="codebox">
Rule Name: Block Guest → All RFC1918
Direction: LAN IN
Interface: Guest
Action: Drop
Source: Guest net (192.168.20.0/24)
Destination: 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16
Comment: Guest only to internet
        </div>
      </div>

      <div class="mt-6 rounded-xl border border-slate-800 bg-slate-900/60 p-4 space-y-4">
        <h3 class="font-semibold text-slate-100">Allow Required Flows</h3>
        <div class="codebox">
Rule Name: Allow Home → IoT Cameras
Direction: LAN IN
Interface: IoT
Action: Accept
Source: Home net (10.10.10.0/24)
Destination: Camera VLAN / specific IPs
Protocol/Port: TCP/UDP 80, 443, 554 (or as required)
Comment: Let Home devices manage/view cameras
        </div>

        <div class="codebox">
Rule Name: Allow IoT → DNS/NTP
Direction: LAN OUT or WAN OUT (depending on design)
Action: Accept
Source: IoT net (192.168.40.0/24)
Destination: AdGuard/Unbound IPs, NTP servers
Ports: UDP 53, 123 (and 853 if using DoT internally)
Comment: Limited, controlled egress for IoT
        </div>
      </div>
    </section>

    <!-- DNS and egress -->
    <section class="mt-10">
      <h2 class="text-2xl font-bold text-slate-100">7. DNS & Egress Control</h2>

      <p class="mt-3 text-slate-300">
        To prevent devices from bypassing AdGuard/Unbound:
      </p>

      <ol class="mt-3 list-decimal list-inside space-y-2 text-slate-300">
        <li>Point DHCP DNS for all VLANs to your internal resolvers (e.g., <code>10.10.10.21</code>, <code>10.10.10.157</code>).</li>
        <li>Create a <strong>WAN OUT</strong> rule that <strong>drops</strong> DNS/DoT from all VLANs to the internet:
          <div class="codebox mt-2">
Rule Name: Block Direct DNS to Internet
Direction: WAN OUT
Action: Drop
Source: RFC1918 nets
Destination: Any
Ports: UDP/TCP 53, 853
Comment: Force use of internal DNS
          </div>
        </li>
      </ol>
    </section>

    <!-- Testing -->
    <section class="mt-10">
      <h2 class="text-2xl font-bold text-slate-100">8. Testing & Validation</h2>

      <ul class="mt-3 list-disc list-inside space-y-2 text-slate-300">
        <li>From a Guest device, confirm it can reach the internet but not ping or RDP into Home subnets.</li>
        <li>From Home, verify you can reach Plex, cameras, and other allowed IoT services, but not arbitrary IoT devices.</li>
        <li>Use UniFi’s <strong>Traffic &amp; Insights</strong> to confirm flows match expectations.</li>
        <li>Log into a test device on each VLAN and run:
          <div class="codebox mt-2">
nslookup google.com
tracert 8.8.8.8
          </div>
          Confirm DNS and path go where you expect.
        </li>
      </ul>
    </section>

    <!-- Footer -->
    <footer class="mt-20 py-10 text-center text-xs text-slate-500">
      © <span id="y"></span> Michael Dziegiel — Built with GitHub Pages
    </footer>
  </main>

  <script>
    document.getElementById('y').textContent = new Date().getFullYear();
  </script>
</body>
</html>
