<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Home Assistant Automations — Homelab</title>
  <link rel="icon" href="../favicon.png" />
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    .codebox {
      @apply whitespace-pre-wrap break-words bg-slate-800/50 rounded-xl p-4 overflow-x-auto text-sm text-slate-200 border border-slate-700;
    }
    body { scroll-behavior: smooth; }
  </style>
</head>

<body class="bg-[#0b0c0e] text-slate-200">
  <!-- Header -->
  <header class="sticky top-0 z-40 backdrop-blur bg-black/40 border-b border-slate-800">
    <div class="max-w-6xl mx-auto px-5 py-4 flex items-center justify-between">
      <a href="/" class="text-slate-100 font-semibold tracking-tight text-lg">mrdtech</a>
      <nav class="hidden sm:flex gap-6 text-sm text-slate-300">
        <a href="/#projects" class="hover:text-emerald-400">Projects</a>
        <a href="/#experience" class="hover:text-emerald-400">Experience</a>
        <a href="/#skills" class="hover:text-emerald-400">Skills</a>
        <a href="/#contact" class="hover:text-emerald-400">Contact</a>
      </nav>
    </div>
  </header>

  <!-- Main -->
  <main class="max-w-5xl mx-auto px-5 py-14">

    <h1 class="text-3xl sm:text-4xl font-extrabold text-slate-100">
      Home Assistant Automations — Homelab
    </h1>

    <p class="mt-4 text-slate-400 leading-relaxed">
      Home Assistant is the central automation engine of the homelab, running on a dedicated VLAN
      with IoT isolation, custom dashboards, integrations, and automations for lighting, cameras,
      notifications, and system monitoring. This guide covers Docker Compose deployment on Ubuntu,
      VLAN design, and recommended security practices.
    </p>

    <!-- Section 1 -->
    <section class="mt-12">
      <h2 class="text-2xl font-bold text-slate-100">1. Prerequisites</h2>

      <ul class="list-disc list-inside mt-4 text-slate-300 space-y-2">
        <li>Ubuntu host or Proxmox LXC/VM</li>
        <li>Docker + Docker Compose installed</li>
        <li>Dedicated VLAN for IoT devices (recommended)</li>
        <li>mDNS reflector enabled on your firewall (UDM/pfSense)</li>
      </ul>
    </section>

    <!-- Section 2 -->
    <section class="mt-12">
      <h2 class="text-2xl font-bold text-slate-100">2. Deploy Home Assistant with Docker Compose</h2>

      <p class="mt-3 text-slate-300">
        Create the directory:
      </p>

      <pre class="codebox mt-4"><code>
mkdir -p /opt/homeassistant
cd /opt/homeassistant
      </code></pre>

      <p class="mt-4 text-slate-300">
        Create <code>docker-compose.yml</code>:
      </p>

      <pre class="codebox mt-4"><code>
version: "3.9"

services:
  homeassistant:
    container_name: homeassistant
    image: ghcr.io/home-assistant/home-assistant:stable
    volumes:
      - ./config:/config
    environment:
      - TZ=America/New_York
    network_mode: host
    restart: unless-stopped
      </code></pre>

      <p class="mt-4 text-slate-400">
        <strong>Note:</strong> Home Assistant must run in <strong>host mode</strong> for mDNS, discovery, and integrations to work correctly.
      </p>

      <pre class="codebox mt-4"><code>
docker compose up -d
      </code></pre>

      <p class="mt-4 text-slate-300 text-sm">
        Access HA at: <strong>http://your-server-ip:8123</strong>
      </p>
    </section>

    <!-- Section 3 -->
    <section class="mt-12">
      <h2 class="text-2xl font-bold text-slate-100">3. VLAN & Network Design</h2>

      <p class="mt-3 text-slate-300">
        Recommended segmentation for Home Assistant:
      </p>

      <ul class="list-disc list-inside mt-4 text-slate-300 space-y-2">
        <li><strong>IoT VLAN:</strong> Cameras, smart plugs, sensors</li>
        <li><strong>Home VLAN:</strong> Phones, laptops, dashboards</li>
        <li><strong>HA VLAN (optional):</strong> If running HA on a dedicated subnet</li>
      </ul>

      <p class="mt-4 text-slate-400">
        Allow the following between Home Assistant and IoT VLAN:
      </p>

      <ul class="list-disc list-inside mt-4 text-slate-300 space-y-2">
        <li><strong>TCP 80/443</strong> (local APIs)</li>
        <li><strong>UDP 5353</strong> (mDNS discovery)</li>
        <li><strong>Vendor ports:</strong> ESPHome, ONVIF, Hue, etc.</li>
      </ul>
    </section>

    <!-- Section 4 -->
    <section class="mt-12">
      <h2 class="text-2xl font-bold text-slate-100">4. Key Integrations</h2>

      <ul class="list-disc list-inside mt-4 text-slate-300 space-y-2">
        <li><strong>UniFi Protect</strong> — camera feeds + motion events</li>
        <li><strong>AdGuard Home</strong> — DNS filtering & stats</li>
        <li><strong>Uptime Kuma</strong> — service uptime monitoring</li>
        <li><strong>Tailscale</strong> — remote access with ACLs</li>
        <li><strong>MQTT (Mosquitto)</strong> — sensors, ESP32, IoT devices</li>
        <li><strong>ESPHome</strong> — custom sensors & switches</li>
      </ul>
    </section>

    <!-- Section 5 -->
    <section class="mt-12">
      <h2 class="text-2xl font-bold text-slate-100">5. Example Automations</h2>

      <p class="mt-3 text-slate-300">Automation 1 — Alert when a service monitored by Uptime Kuma goes down:</p>

      <pre class="codebox mt-4"><code>
alias: Service Down Alert
trigger:
  - platform: webhook
    webhook_id: uptime_kuma_down
action:
  - service: notify.mobile_app_pixel
    data:
      message: "A monitored service is DOWN."
      </code></pre>

      <p class="mt-6 text-slate-300">Automation 2 — Turn on lights when camera detects motion:</p>

      <pre class="codebox mt-4"><code>
alias: Motion Lighting
trigger:
  - platform: state
    entity_id: binary_sensor.driveway_motion
    to: "on"
action:
  - service: light.turn_on
    entity_id: light.driveway
      </code></pre>

      <p class="mt-6 text-slate-300">Automation 3 — Night mode when everyone leaves home:</p>

      <pre class="codebox mt-4"><code>
alias: Night Mode Away
trigger:
  - platform: state
    entity_id: group.family
    to: "not_home"
action:
  - service: climate.set_temperature
    data:
      entity_id: climate.main
      temperature: 64
  - service: lock.lock
    entity_id: lock.front_door
      </code></pre>
    </section>

    <!-- Section 6 -->
    <section class="mt-12">
      <h2 class="text-2xl font-bold text-slate-100">6. Hardening & Security</h2>

      <ul class="list-disc list-inside mt-4 text-slate-300 space-y-2">
        <li>Place IoT devices in a separate VLAN</li>
        <li>Use Tailscale or Cloudflare Tunnel for remote access</li>
        <li>Enable two-factor authentication</li>
        <li>Limit HA firewall rules to only required ports</li>
        <li>Keep integrations updated (especially MQTT + ESPHome)</li>
      </ul>
    </section>

    <!-- Footer -->
    <footer class="mt-20 py-10 text-center text-xs text-slate-500">
      © <span id="y"></span> Michael Dziegiel — Built with GitHub Pages
    </footer>
  </main>

  <script>
    document.getElementById('y').textContent = new Date().getFullYear();
  </script>

</body>
</html>
